<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Risk Category Prediction</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="number"], input[type="text"] { width: calc(100% - 22px); padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #predictionResult { margin-top: 20px; padding: 10px; border: 1px solid #eee; background-color: #f9f9f9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Credit Risk Category Prediction</h1>

        <form id="predictionForm">
            <label for="CreditScore">CreditScore:</label>
            <input type="number" id="CreditScore" name="CreditScore" step="any" value="0" required><br>
            <label for="FirstPaymentDate">FirstPaymentDate:</label>
            <input type="number" id="FirstPaymentDate" name="FirstPaymentDate" step="any" value="0" required><br>
            <label for="FirstTimeHomebuyer">FirstTimeHomebuyer:</label>
            <input type="number" id="FirstTimeHomebuyer" name="FirstTimeHomebuyer" step="any" value="0" required><br>
            <label for="MaturityDate">MaturityDate:</label>
            <input type="number" id="MaturityDate" name="MaturityDate" step="any" value="0" required><br>
            <label for="MSA">MSA:</label>
            <input type="number" id="MSA" name="MSA" step="any" value="0" required><br>
            <label for="MIP">MIP:</label>
            <input type="number" id="MIP" name="MIP" step="any" value="0" required><br>
            <label for="Units">Units:</label>
            <input type="number" id="Units" name="Units" step="any" value="0" required><br>
            <label for="Occupancy">Occupancy:</label>
            <input type="number" id="Occupancy" name="Occupancy" step="any" value="0" required><br>
            <label for="OCLTV">OCLTV:</label>
            <input type="number" id="OCLTV" name="OCLTV" step="any" value="0" required><br>
            <label for="DTI">DTI:</label>
            <input type="number" id="DTI" name="DTI" step="any" value="0" required><br>
            <label for="OrigUPB">OrigUPB:</label>
            <input type="number" id="OrigUPB" name="OrigUPB" step="any" value="0" required><br>
            <label for="LTV">LTV:</label>
            <input type="number" id="LTV" name="LTV" step="any" value="0" required><br>
            <label for="OrigInterestRate">OrigInterestRate:</label>
            <input type="number" id="OrigInterestRate" name="OrigInterestRate" step="any" value="0" required><br>
            <label for="Channel">Channel:</label>
            <input type="number" id="Channel" name="Channel" step="any" value="0" required><br>
            <label for="PPM">PPM:</label>
            <input type="number" id="PPM" name="PPM" step="any" value="0" required><br>
            <label for="ProductType">ProductType:</label>
            <input type="number" id="ProductType" name="ProductType" step="any" value="0" required><br>
            <label for="PropertyState">PropertyState:</label>
            <input type="number" id="PropertyState" name="PropertyState" step="any" value="0" required><br>
            <label for="PropertyType">PropertyType:</label>
            <input type="number" id="PropertyType" name="PropertyType" step="any" value="0" required><br>
            <label for="PostalCode">PostalCode:</label>
            <input type="number" id="PostalCode" name="PostalCode" step="any" value="0" required><br>
            <label for="LoanPurpose">LoanPurpose:</label>
            <input type="number" id="LoanPurpose" name="LoanPurpose" step="any" value="0" required><br>
            <label for="OrigLoanTerm">OrigLoanTerm:</label>
            <input type="number" id="OrigLoanTerm" name="OrigLoanTerm" step="any" value="0" required><br>
            <label for="NumBorrowers">NumBorrowers:</label>
            <input type="number" id="NumBorrowers" name="NumBorrowers" step="any" value="0" required><br>
            <label for="SellerName">SellerName:</label>
            <input type="number" id="SellerName" name="SellerName" step="any" value="0" required><br>
            <label for="ServicerName">ServicerName:</label>
            <input type="number" id="ServicerName" name="ServicerName" step="any" value="0" required><br>
            <label for="EverDelinquent">EverDelinquent:</label>
            <input type="number" id="EverDelinquent" name="EverDelinquent" step="any" value="0" required><br>
            <label for="MonthsDelinquent">MonthsDelinquent:</label>
            <input type="number" id="MonthsDelinquent" name="MonthsDelinquent" step="any" value="0" required><br>
            <label for="MonthsInRepayment">MonthsInRepayment:</label>
            <input type="number" id="MonthsInRepayment" name="MonthsInRepayment" step="any" value="0" required><br>
            <label for="MonthlyIncome">MonthlyIncome:</label>
            <input type="number" id="MonthlyIncome" name="MonthlyIncome" step="any" value="0" required><br>
            <label for="InterestBurden">InterestBurden:</label>
            <input type="number" id="InterestBurden" name="InterestBurden" step="any" value="0" required><br>
            <label for="LTV_Diff">LTV_Diff:</label>
            <input type="number" id="LTV_Diff" name="LTV_Diff" step="any" value="0" required><br>
            <label for="MIP_Ratio">MIP_Ratio:</label>
            <input type="number" id="MIP_Ratio" name="MIP_Ratio" step="any" value="0" required><br>
            <label for="MultipleBorrowers">MultipleBorrowers:</label>
            <input type="number" id="MultipleBorrowers" name="MultipleBorrowers" step="any" value="0" required><br>
            <label for="log_OrigUPB">log_OrigUPB:</label>
            <input type="number" id="log_OrigUPB" name="log_OrigUPB" step="any" value="0" required><br>
            <label for="log_DTI">log_DTI:</label>
            <input type="number" id="log_DTI" name="log_DTI" step="any" value="0" required><br>
            <label for="log_MIP">log_MIP:</label>
            <input type="number" id="log_MIP" name="log_MIP" step="any" value="0" required><br>
            <label for="OrigUPB.1">OrigUPB.1:</label>
            <input type="number" id="OrigUPB.1" name="OrigUPB.1" step="any" value="0" required><br>
            <label for="DTI.1">DTI.1:</label>
            <input type="number" id="DTI.1" name="DTI.1" step="any" value="0" required><br>
            <label for="OrigUPB DTI">OrigUPB DTI:</label>
            <input type="number" id="OrigUPB DTI" name="OrigUPB DTI" step="any" value="0" required><br>
            <label for="PCA_1">PCA_1:</label>
            <input type="number" id="PCA_1" name="PCA_1" step="any" value="0" required><br>
            <label for="PCA_2">PCA_2:</label>
            <input type="number" id="PCA_2" name="PCA_2" step="any" value="0" required><br>
            <label for="PCA_3">PCA_3:</label>
            <input type="number" id="PCA_3" name="PCA_3" step="any" value="0" required><br>
            <label for="PCA_4">PCA_4:</label>
            <input type="number" id="PCA_4" name="PCA_4" step="any" value="0" required><br>
            <label for="PCA_5">PCA_5:</label>
            <input type="number" id="PCA_5" name="PCA_5" step="any" value="0" required><br>

            <button type="submit">Predict Credit Risk Category</button>
        </form>
        <div id="predictionResult">
            Prediction will appear here.
        </div>
    </div>

    <script>
        document.getElementById('predictionForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                if (!isNaN(parseFloat(value)) && isFinite(value)) {
                    data[key] = parseFloat(value);
                } else {
                    data[key] = value; // Keep non-numeric values as strings if any
                }
            }
            console.log("Sending data:", data);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                const resultDiv = document.getElementById('predictionResult');

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <p><strong>Prediction:</strong> ${result.prediction === 0 ? 'Low Risk' : 'High Risk'}</p>
                        <p><strong>Probability (Low Risk):</strong> ${(result.probability_class_0 * 100).toFixed(2)}%</p>
                        <p><strong>Probability (High Risk):</strong> ${(result.probability_class_1 * 100).toFixed(2)}%</p>
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">Error: ${result.error || 'Something went wrong'}</p>`;
                }

            } catch (error) {
                document.getElementById('predictionResult').innerHTML = `<p style="color: red;">Network Error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>